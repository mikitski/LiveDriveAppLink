<!doctype html>
<html>
  <head>
    <meta charset=utf-8>
    <style>
      .center-div {
      	  margin-top:auto;
      	  margin-right:auto;
      	  margin-botton:auto;
      	  margin-left:67px;
          width: 80%;
          height: 80%;
      }
      .wheelGray {
        fill: rgba(241, 241, 241, .78);
      }
      .wheelBlue {
        fill: rgba(85, 138, 208, 0.78);
      }
      .wheelGreen {
        fill: rgba(0, 156, 26, 0.78);
      }
      .wheelRed {
        fill: rgba(205, 32, 39, 0.78);
      }
      .wheelOuterGreen {
        fill: rgba(64, 194, 0, 0.78);
      }
      #blueEmptyCircle {
        fill: rgb(255,255,255);
        stroke: rgba(85, 138, 208, 0.78);
        stroke-width: 2px;
      }
      #redEmptyCircle {
        fill: rgb(255,255,255);
        stroke: rgba(205, 32, 39, 0.78);
        stroke-width: 2px;
      }
      #greenEmptyCircle {
        fill: rgb(255,255,255);
        stroke: rgba(0, 156, 26, 0.78);
        stroke-width: 2px;
      }
      @font-face {
        font-family: 'OpenSans';
        src: url("OpenSans-Regular.ttf") format("truetype");
      }
      text.textRed {
        font-family: OpenSans;
        font-size: 212.5px;
        font-weight: 400;
        fill: rgba(205, 32, 39, 0.78);
      }
      text.textGreen {
        font-family: OpenSans;
        font-size: 212.5px;
        font-weight: 400;
        fill: rgba(0, 156, 26, 0.78);
      }
      text.markerText {
        font-family: OpenSans;
        font-size: 34px;
        font-weight: 600;
        fill: rgb(255, 255, 255);
      }
      text.textDriverScore {
        font-family: OpenSans;
        font-size: 34px;
        font-weight: 600;
      }
      div.padding {
        padding-bottom: 150px;
      }

      h1 
      {
        font-family: "Lucida Sans Unicode", "Lucida Grande", Sans-Serif;
        font-size: 28px;
        text-align: center;
        color: #039;
        font-weight: bold;;
      }

      .datatable
      {
        font-family: "Lucida Sans Unicode", "Lucida Grande", Sans-Serif;
        font-size: 18px;
        background: #fff;
        margin: 60px;
        width: 660px;
        height: 500px;
        border-collapse: collapse;
        text-align: left;
      }
      th
      {
        font-size: 24px;
        font-weight: normal;
        color: #039;
        padding: 10px 8px;
        border-bottom: 2px solid #6678b1;
      }
      td
      {
        border-bottom: 1px solid #ccc;
        color: #669;
        padding: 6px 8px;
      }
      tbody tr:hover td
      {
        color: #009;
      }
      tbody tr:first-child {background-color: #e8edff}
    </style>
    <link rel="stylesheet" type="text/css" href="./jcarousel.responsive.css">
    <script src="d3.min.js"></script>
    <script type="text/javascript" src="./jquery.min.js"></script>
    <script type="text/javascript" src="./jquery.jcarousel.min.js"></script>
    <script type="text/javascript" src="./jcarousel.responsive.js"></script>
  </head>
  <body>
    <div class="padding">
    </div>
    <div class="wrapper">
      <div class="jcarousel-wrapper">
        <div class="jcarousel">
          <ul>
            <li>
              <div id="driver_score" class="center-div">
              </div>
            </li>
            <li>
              <div id="mpg_score" class="center-div">
              </div>
            </li>
            <li>
              <div id="driver_leaderboard" class="center-div">
                <h1>Driver Leaderboard<h1>
              </div>
            </li>
            <li>
              <div id="mpg_leaderboard" class="center-div">
		            <h1>MPG Leaderboard</h1>
              </div>
            </li>
            </ul>
          </div>
          <a href="#" class="jcarousel-control-prev">&lsaquo;</a>
          <a href="#" class="jcarousel-control-next">&rsaquo;</a>
        <p class="jcarousel-pagination"></p>
      </div>
    </div>
    <script>

function placeOnCircle(centerX, centerY, radius, angleRadians) {
  var x = centerX - (radius * Math.sin(angleRadians));
  var y = centerY + (radius * Math.cos(angleRadians));
  return { x: x, y: y };
}

function genericScore(innerScore, outerScore, rank, divName, bottomSVG, text, outerWheelCSS, markerSVG) {
  var driverScore = document.getElementById(divName);
  var didScoreGoDown = outerScore - innerScore > 0;

  d3.select(driverScore).select("svg").remove();
  var svg = d3.select(driverScore).append("svg")
              .attr("width", 1000).attr("height", 760);

  svg.append("image")
      .attr("xlink:href", "MeterRing.svg")
      .attr("width", "720").attr("height", "720")
      .attr("x", 21).attr("y", 21);

  var data = [outerScore, (100-outerScore)];
  var pie = d3.layout.pie();
  pie.startAngle(0);
  pie.endAngle(2*Math.PI - (Math.PI/3));
  var pieResults = pie(data);

  var arc = d3.svg.arc();
  arc.innerRadius(function(d) { return 308; });
  arc.outerRadius(function(d) { return 380; });
  d3.select(driverScore).select("svg").selectAll("g.arc")
    .data(pieResults)
    .enter()
    .append("g").attr("class", "arc").attr("transform", "translate(380, 380) rotate(210)")
    .append("path")
    .classed(outerWheelCSS, function(d,i) { if (i == 0) { return true; } })
    .classed("wheelGray", function(d,i) { if (i != 0) { return true; } })
    .attr("d", arc);

  var blueEmptyPos = placeOnCircle(380, 380, 345, pieResults[0].endAngle + Math.PI / 6);
  svg.append("circle").attr("r", "36").attr("transform", "translate("+ blueEmptyPos.x +","+ blueEmptyPos.y +")").attr("id", "blueEmptyCircle");

  svg.append("image")
     .attr("xlink:href", markerSVG)
     .attr("width", "128").attr("height", "120")
     .attr("x", blueEmptyPos.x).attr("y", blueEmptyPos.y - 120);
  svg.append("text").classed("markerText", true).attr("transform", "translate("+(blueEmptyPos.x+60)+","+(blueEmptyPos.y-70)+") scale(1.399,1.398)").text(outerScore);

  var data2 = [innerScore, (100-innerScore)];
  var pieResults2 = pie(data2);
  var arcInner = d3.svg.arc();
  arcInner.innerRadius(function(d) { return 243; });
  arcInner.outerRadius(function(d) { return 300; });

  d3.select(driverScore).select("svg").selectAll("g.arcInner")
    .data(pieResults2)
    .enter()
    .append("g").attr("class", "arcInner").attr("transform", "translate(381, 381) rotate(210)")
    .append("path")
    .classed("wheelGreen", function(d,i) { if (i == 0 && !didScoreGoDown) { return true; } })
    .classed("wheelRed", function(d,i) { if (i == 0 && didScoreGoDown) { return true; } })
    .classed("wheelGray", function(d,i) { if (i != 0) { return true; } })
    .attr("d", arcInner);

  var innerEmptyPos = placeOnCircle(381, 381, 272, pieResults2[0].endAngle + Math.PI / 6);
  svg.append("circle").attr("r", "29").attr("transform", "translate("+ innerEmptyPos.x +","+ innerEmptyPos.y +")").attr("id", didScoreGoDown?"redEmptyCircle":"greenEmptyCircle");

  d3.select(driverScore).select("svg").append("text").attr("transform", "translate(220,470) scale(1.399, 1.398)").text(innerScore).classed(didScoreGoDown?"textRed":"textGreen", true);
  d3.select(driverScore).select("svg").append("text").attr("transform", "translate(249,530) scale(1.399, 1.398)").text(text).classed("textDriverScore", true);

  svg.append("image")
     .attr("xlink:href", bottomSVG)
     .attr("width", "220").attr("height", "280")
     .attr("x", 293).attr("y", 513);

  d3.select(driverScore).select("svg").append("text").attr("transform", "translate(442,715)").text(rank).attr("style", "font-family:Arial; font-size: 43px;");

}

function drawDriverScore(innerScore, outerScore, rank) {
  genericScore(innerScore, outerScore, rank, "driver_score", "Driver_Marker 1.svg", "Driver Score", "wheelBlue", "Driver_Marker.svg");
}

function drawMpgScore(innerScore, outerScore, rank) {
  genericScore(innerScore, outerScore, rank, "mpg_score", "Fuel Icon 1.svg", "Eco Score", "wheelOuterGreen", "MPG_Marker.svg");
}

function drawDriverLeaderBoardForDriver(rank, imageUrl, userName, score) {
  //TODO
} 

function drawDriverLeadBoardForOtherDrivers(otherDriverInfo) {
  //TODO
}

function tabulate(data, columns, tableContainer) {

    var table = d3.select(tableContainer).append("table").attr("class", "datatable");
        thead = table.append("thead"),
        tbody = table.append("tbody");

    // append the header row
    thead.append("tr")
        .selectAll("th")
        .data(columns)
        .enter()
        .append("th")
        .text(function(column) { return column; });

    // create a row for each object in the data
    var rows = tbody.selectAll("tr")
        .data(data)
        .enter()
        .append("tr");

    // create a cell in each row for each column
    var cells = rows.selectAll("td")
        .data(function(row) {
            return columns.map(function(column) {
                console.log(column);
                if (column == "image") {
                  //return {column: column, value: "<img src=\"" + row[column] + "\" style=\"width:50px;height:50px\">"};
                  return {column: column, value: "<img src=\"" + row[column] + "\" width=\"50px\" height=\"50px\">"};
                };

                return {column: column, value: row[column]};
            });
        })
        .enter()
        .append("td")
        .attr("style", "font-family: Arial, font-size: 23px")
        .html(function(d) { return d.value; });
    
    return table;
}

 drawDriverScore(79, 76, 10);
 drawMpgScore(60, 70, 23);

 var driverData = new Array(
  { rank: 3, image: "./img/LD%20Logo%201.png", name: "LadiesMan217", score: 79 },
  { rank: 1, image: "./img/mikitski.png", name: "mikitski", score: 91 },
  { rank: 2, image: "./img/mrcarlosrendon.jpeg", name: "mrcarlosrendon", score: 85 },
  { rank: 4, image: "./img/jnesis.png", name: "jnesis", score: 65 }); 


  var mpgData = new Array(
  { rank: 3, image: "./img/LD%20Logo%201.png", name: "LadiesMan217", score: 60 },
  { rank: 1, image: "./img/mikitski.png", name: "mikitski", score: 91 },
  { rank: 2, image: "./img/mrcarlosrendon.jpeg", name: "mrcarlosrendon", score: 85 },
  { rank: 4, image: "./img/jnesis.png", name: "jnesis", score: 60 }); 

// render the table
var driverLeaderBoardTable = tabulate(driverData, ["rank", "image", "name", "score"], "#driver_leaderboard");

var mpgLeaderBoardTable = tabulate(mpgData, ["rank", "image", "name", "score"], "#mpg_leaderboard")

function fixTableTitle(tableObject) {
  tableObject.selectAll("thead th")
      .text(function(column) {
          return column.charAt(0).toUpperCase() + column.substr(1);
      });
}

fixTableTitle(driverLeaderBoardTable);
fixTableTitle(mpgLeaderBoardTable);

 var otherDriverInfo = '{ "otherDrivers" : [' +
                          '{1, "./image/mikitski.png", "mikitski", 91},' +
                          '{2, "./image/mrcarlosrendon.jpeg", "mrcarlosrendon", 85},' +
                          '{4, "./image/jnesis.png", "jnesis", 65},' +
                        ']}';
 // drawDriverLeadBoardForOtherDrivers(otherDriverInfo);
    </script>
  </body>
</html>
